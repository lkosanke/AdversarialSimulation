---
title: "AnalyzeResults"
author: "Valentin Kriegmair"
format:
  pdf:
    documentclass: article
    margin-left: 1in
    margin-right: 1in
    margin-top: 1in
    margin-bottom: 1in
  html:
    toc: true
bibliography: ../../bibliography.bib
editor: visual
---

```{r}
library(dplyr)
library(tidyr)
library(kableExtra)
```

The following represents the evaluation and interpretation of the results generated by simulation study 1 and study 2 as a conceptual replication of @rosseel_structural_2022 and @dhaene_evaluation_2023.

# Study 1

```{r}
# Load the processed data
processed_data <- readRDS("results/processed_data.rds")
summary_1 <- processed_data$summary
detailed_results_1 <- processed_data$detailed
```

```{r}
head(summary_1)
head(detailed_results_1)
View(summary_1)
```

## Convergence Rate

```{r}

# Select and rename columns
convergence_table <- summary_1 %>%
  select(model_type, N, reliability, method, ConvergenceRate) %>%
  rename(
    Model = model_type,
    Reliability = reliability,
    N = N,
    Method = method,
    `Convergence Rate` = ConvergenceRate
  ) %>%
  mutate(Method = recode(Method, 
                         SEM = "SEM", 
                         gSAM = "GSAM", 
                         lSAM_ML = "SAM-ML", 
                         lSAM_ULS = "SAM-ULS"))

# Create and display the table
formatted_table <- convergence_table %>%
  kbl(caption = "Percentage of Observed Datasets That Converged Under Correctly Assumed Models Using Each Estimation Method",
      format = "html", booktabs = TRUE) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))

formatted_table

```

## Average Relative Biases (in Percentages) 

In this study, we diverge from the original study of Rosseel (2022) by focusing exclusively on the average relative bias under a single type of correctly specified model (model 1), which does not include any cross loadings or correlated residuals. This simplification, while debatable, allows us to concentrate on the core advantage of SAM over traditional SEM: its more robust estimation of structural parameters, especially when measurement models are misspecified. By narrowing the scope, we aim to highlight SAM's robustness and its potential as a superior alternative in scenarios where traditional SEM may falter.

```{r}
# Average Relative Biases Table
average_relative_bias_table <- summary_1 %>%
  select(model_type, N, reliability, method, MeanRelativeBias) %>%
  rename(
    Model = model_type,
    Reliability = reliability,
    N = N,
    Method = method,
    `Average Relative Bias (%)` = MeanRelativeBias
  ) %>%
  mutate(
    Method = recode(Method, 
                    SEM = "SEM", 
                    gSAM = "GSAM", 
                    lSAM_ML = "SAM-ML", 
                    lSAM_ULS = "SAM-ULS"),
    `Average Relative Bias (%)` = `Average Relative Bias (%)` * 100
  )

# Create and display the table
formatted_bias_table <- average_relative_bias_table %>%
  kbl(caption = "Average Relative Biases (in Percentages) Under Correctly Assumed Models Using Each Estimation Method",
      format = "html", booktabs = TRUE) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))

formatted_bias_table

```

# Coverage

```{r}


```
